<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/g.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/g.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/g.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="躲不掉的风">
<meta property="og:url" content="http://yoursite.com/page/12/index.html">
<meta property="og:site_name" content="躲不掉的风">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="躲不掉的风">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/12/">





  <title>躲不掉的风</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">躲不掉的风</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/09/Django项目实例精讲/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="躲不掉的风">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="躲不掉的风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/09/Django项目实例精讲/" itemprop="url">Django项目实例精讲</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-09T22:16:15+08:00">
                2018-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="认识Django"><a href="#认识Django" class="headerlink" title="认识Django"></a>认识Django</h4><ol>
<li><p>Python下有许多款不同的 Web 框架。Django是<strong>重量级</strong>选手中最有代表性的一位。许多成功的网站和APP都基于Django。</p>
</li>
<li><p>Django是一个<strong>开放源代码</strong>的Web应用框架，由<strong>Python</strong>写成。</p>
</li>
<li><p>Django采用了MVC的软件设计模式，即模型M，视图V和控制器C</p>
</li>
</ol>
<h4 id="1-创建隔离的python环境"><a href="#1-创建隔离的python环境" class="headerlink" title="1. 创建隔离的python环境"></a>1. 创建隔离的python环境</h4><p>推荐文章：<a href="https://www.cnblogs.com/jasmine-Jobs/p/7045016.html" target="_blank" rel="noopener">https://www.cnblogs.com/jasmine-Jobs/p/7045016.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv #安装</span><br><span class="line">virtualenv my_env#创建目录</span><br><span class="line">which python3  #找到python3目录</span><br><span class="line">virtualenv my_env -p /Library/Frameworks/Python.framework/Versions/3.7/bin/python3 </span><br><span class="line">#将python3作为解释器</span><br><span class="line">source my_env/bin/activate  #激活，开始使用</span><br><span class="line">deactivate 退出</span><br></pre></td></tr></table></figure>

<h4 id="2-安装Django"><a href="#2-安装Django" class="headerlink" title="2. 安装Django"></a>2. 安装Django</h4><p> pip install Django==2.0.5</p>
<h4 id="3-创建项目"><a href="#3-创建项目" class="headerlink" title="3. 创建项目"></a>3. 创建项目</h4><p>  Django-admin startproject mysite<br>    mysite/项目结构：<br>        manage.py<br>        mysite/<br>              &nbsp;<em>&nbsp;<strong>init</strong>.py<br>              &nbsp;</em>&nbsp;<em>setting.py<br>             &nbsp;</em> &nbsp;<em>url.py<br>              &nbsp;</em>&nbsp;_wsgi.py<br>python manage.py migrate  #通过数据库迁移，初始状态下的应用程序表将在数据库中被创建。<br>创建完成后，根目录里应该多了个db.sqlite3</p>
<h4 id="4-运行开发服务器"><a href="#4-运行开发服务器" class="headerlink" title="4.  运行开发服务器"></a>4.  运行开发服务器</h4><pre><code>python manage.py runserver

- 认识项目设置setting.py
    DEBUG在生产环境下应该置为False.
 - 项目和应用程序
 “项目”我理解为所有应用程序基于某些设置项的安装结果。
 “应用程序”（即app，也就是下文中的blog）是模型+试图+模板+url 的组合
 应用程序与框架进行交互，提供特定的功能。</code></pre><h4 id="5-创建应用程序"><a href="#5-创建应用程序" class="headerlink" title="5.  创建应用程序"></a>5.  创建应用程序</h4><p> 继续在虚拟环境里执行 python manage.py  startapp blog<br>此时多了个blog/目录 和下面文件如下：<br>admin.py 可在该文件中注册模型<br>app.py 包含了blog这个应用程序主要配置内容（之后在激活app时候用到）<br>migrations包含了应用程序(app)的数据库迁移。迁移可以使Django跟踪模块 变化内容，并相应的同步数据库。<br>model.py 包含了应用程序的数据模型，但是也可以被置空。<br>test.py 用来测试的<br>views.py包含逻辑内容  </p>
<h4 id="6-数据模型"><a href="#6-数据模型" class="headerlink" title="6. 数据模型"></a>6. 数据模型</h4><p> 每个模型是一个python类，为django.db.models.Model的子类，每个属性视为数据库的一个字段。  </p>
<ul>
<li>创建model.py文件中的数据表（即各python类）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">from django.utils import timezone</span><br><span class="line">from  django.contrib.auth.models import User</span><br><span class="line"># Create your models here.</span><br><span class="line"></span><br><span class="line">class Post(models.Model):</span><br><span class="line">    STATUS_CHOICE=((&apos;draft&apos;,&apos;Draft&apos;),(&apos;published&apos;,&apos;Published&apos;))</span><br><span class="line">    title=models.CharField(max_length=250)</span><br><span class="line">    slug=models.SlugField(max_length=250,unique_for_date=&apos;publish&apos;)</span><br><span class="line">    author=models.ForeignKey(User,on_delete=models.CASCADE,related_name=&apos;blog_posts&apos;,default=&quot;&quot;)</span><br><span class="line">    body=models.TextField(default=&quot;&quot;)</span><br><span class="line">    publish=models.DateTimeField(default=timezone.now)</span><br><span class="line">    created=models.DateTimeField(auto_now_add=True)</span><br><span class="line">    #auto_now_add=True：实例在第一次保存的时候自动保存当前时间，不能手动修改(但相对于auto_now，auto_now_add下次是可以的)。</span><br><span class="line">    status=models.CharField(max_length=10,choices=STATUS_CHOICE,default=&apos;draft&apos;)</span><br><span class="line">    class Meta:</span><br><span class="line">        ordering=(&apos;-publish&apos;,)</span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.title</span><br></pre></td></tr></table></figure>

<p>其中ForeignKey 的用法，待总结。。</p>
<ul>
<li><p>为了使Django跟踪应用程序并针对模型创建数据表，我们需要激活：<br>&nbsp; &nbsp;编辑setting.py文件，像INSTALLED_APPS设置中加入app.py中所用到的类BlogConfig。格式为’blog.apps.BlogConfig’（若使用pycharm等IDE可能会给自动创建，可省略此步）</p>
</li>
<li><p>迁移两步走<br>创建了数据模型，我们最终需要的是定义<strong>数据库</strong>表，所以我们需要迁移：<br>1）python manage.py makemigrations blog  #让 Django 知道我们在我们的模型有一些变更，此时生成了0001_initial.py文件</p>
<pre><code>python manage.py sqlmigrate blog 0001 #命令可以查看某次迁移的SQL语句。</code></pre><p>2） python manage.py migrate  #将数据库与模型最终同步。</p>
<p>初始化注意三步走：<a href="https://www.runoob.com/django/django-model.html" target="_blank" rel="noopener">https://www.runoob.com/django/django-model.html</a></p>
<p><img src="/images/pasted-134.png" alt="upload successful"></p>
<h4 id="7-站点管理"><a href="#7-站点管理" class="headerlink" title="7. 站点管理"></a>7. 站点管理</h4></li>
<li><h6 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h6><p>什么是站点？<br>对应的是之前说的admin.py应用。只要启动项目后，打开/admin/路径即可。<br>但是前提是需要创建超级用户（不然也登不进去呀）<br>python manage.py createsuperuser</p>
</li>
<li><h5 id="向站点添加模型"><a href="#向站点添加模型" class="headerlink" title="向站点添加模型"></a>向站点添加模型</h5><p>重点来啦<del>~</del> 怎么把模型添加到站点，以后方便我们维护呢？<br>编辑admin.py文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line">from .models import Post.</span><br><span class="line">admin.site.register(Post)  # 注册模型</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>之后打开站点就可以看到我们的模型啦，打开后就可以进行维护啦</p>
<h4 id="8-定制模型的显示方式"><a href="#8-定制模型的显示方式" class="headerlink" title="8.  定制模型的显示方式"></a>8.  定制模型的显示方式</h4><p>待整理</p>
<h4 id="9-QuerySet和管理器"><a href="#9-QuerySet和管理器" class="headerlink" title="9. QuerySet和管理器"></a>9. QuerySet和管理器</h4><ul>
<li><h6 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h6><p>方法一：两步走</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">post=Post(title=&quot;tile&quot;,slug=&quot;sss&quot;,body=&quot;post body&quot;,suthor=user)</span><br><span class="line">#未插入到数据库</span><br><span class="line">post.save()</span><br><span class="line">#真正执行Insert操作</span><br></pre></td></tr></table></figure>

<p>方法二：一步到位<br>创建对象，并将其持久化至数据库中</p>
</li>
</ul>
<p><code>Post.objects.create(title=&quot;tile&quot;,slug=&quot;sss&quot;,body=&quot;post body&quot;,suthor=user)</code></p>
<ul>
<li><h6 id="更新对象"><a href="#更新对象" class="headerlink" title="更新对象"></a>更新对象</h6>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">	post.title=&quot;new title&quot;</span><br><span class="line">post.save()</span><br></pre></td></tr></table></figure>

<ul>
<li><h6 id="获取对象"><a href="#获取对象" class="headerlink" title="获取对象"></a>获取对象</h6>Django默认管理器objects。通过该管理器得到一个QuerySet对象,常用的方法有<br>Post.objects.all()<br>Post.objects.get(username=’admin’)<br>Post.objects.filter(publish__year=2017)<br>Post.objects.exclude(publish__year=2017)#排除<br>Post.objects.order_by(‘title’)默认升序，降序改为’-title’</li>
</ul>
<p>其他方法可参考官网：<a href="https://docs.djangoproject.com/en/2.0/ref/models" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.0/ref/models</a></p>
</li>
<li><h6 id="删除对象"><a href="#删除对象" class="headerlink" title="删除对象"></a>删除对象</h6><p>post=Post.objects.get(username=’admin’)<br>post.delete()</p>
<h4 id="10-创建视图"><a href="#10-创建视图" class="headerlink" title="10. 创建视图"></a>10. 创建视图</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render,get_object_or_404</span><br><span class="line">#get_object_or_404 若结果不存在则抛出404异常</span><br><span class="line"></span><br><span class="line">from .models import Post</span><br><span class="line"></span><br><span class="line">def blog_list(request):</span><br><span class="line">    post_result=Post.objects.all()</span><br><span class="line">    return  render(request,&apos;post/list.html&apos;,&#123;&apos;post_value&apos;:post_result&#125;)</span><br><span class="line">    #这里返回的字段中的Key即post_value用于在模板中引用</span><br><span class="line">def blog_detail(request,year,month,day,slug):</span><br><span class="line">    post_result=get_object_or_404(Post,slug=slug,publish__year=year,publish__month=month,publish__day=day)</span><br><span class="line">    return  render(request,&apos;post/detail.html&apos;,&#123;&apos;post_value&apos;:post_result&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="11-URL"><a href="#11-URL" class="headerlink" title="11. URL"></a>11. URL</h4><p>这里分为两部分（当然也可以直接在项目url中一步到位，但是在有多个APP的情况下结构清晰，推荐两步）：<br>第一步：创建应用程序的url ：<br>blog/urls.py:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import path</span><br><span class="line">from . import  views</span><br><span class="line"></span><br><span class="line">app_name=&apos;blog&apos;  #本url的命名空间，被引用时使用</span><br><span class="line"></span><br><span class="line">urlpatterns=[</span><br><span class="line">    path(&apos;&apos;,views.blog_list,name=&apos;list_name&apos;),</span><br><span class="line">    path(&apos;&lt;int:year&gt;/&lt;int:month&gt;/&lt;int:day&gt;/&lt;slug:slug&gt;/&apos;,views.blog_detail,name=&apos;detail_name&apos;)</span><br><span class="line">#路径中变量由上一级传参，动态</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>项目urls.py:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path,include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(&apos;admin/&apos;, admin.site.urls),</span><br><span class="line">    path(&apos;post/&apos;,include(&apos;blog.urls&apos;,namespace=&apos;blog&apos;))#引用用应用程序，使用命名空间</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>为了获取url路径需要使用reverse方法，在models.py中添加此函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def get_absolute_url(self):</span><br><span class="line">    return reverse(&apos;blog:detail_name&apos;,args=[self.publish.year,self.publish.month,self.publish.day ,self.slug])</span><br></pre></td></tr></table></figure>

<h4 id="12-创建模板文件"><a href="#12-创建模板文件" class="headerlink" title="12. 创建模板文件"></a>12. 创建模板文件</h4><p>一个基文件base.html和两个继承文件，目录：<br>base.html<br>post/<br>&nbsp;&nbsp;&nbsp;list.html<br>&nbsp;&nbsp;&nbsp;detail.html<br>base.html:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125;  # 加载静态文件</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&#123;% block title %&#125;&#123;% endblock %&#125;&lt;/title&gt;</span><br><span class="line">    &lt;link href=&quot;&#123;% static &quot;css/blog.css&quot; %&#125;&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;content&quot;&gt;</span><br><span class="line">    &#123;% block content %&#125;</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;sidebar&quot;&gt;</span><br><span class="line">    &lt;h2&gt;My base blog&lt;/h2&gt;</span><br><span class="line">    &lt;p&gt;this is my base blog;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>list.html：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;  #继承</span><br><span class="line">&#123;% block title %&#125;My Blog&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">&lt;h1&gt;MY BLOG FOR LIST&lt;/h1&gt;</span><br><span class="line">    &#123;% for p in post_value %&#125;</span><br><span class="line">    &lt;h2&gt;</span><br><span class="line">    &lt;a href=&quot;&#123;&#123; p.get_absolute_url&#125;&#125;&quot;&gt;  #使用此方法获取url</span><br><span class="line">        &#123;&#123; p.title&#125;&#125;&lt;/a&gt;</span><br><span class="line">    &lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">    &lt;p class=&quot;date&quot;&gt;Published&#123;&#123; p.publish &#125;&#125;by &#123;&#123; p.author &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &#123;&#123; p.body|truncatewords:30|linebreaks &#125;&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>detail.html:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;&#123;&#123;post.title&#125;&#125;&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;h1&gt;&#123;&#123;post_value.title&#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;p id =&quot;date&quot;&gt;</span><br><span class="line">    published &#123;&#123; post_value.publish&#125;&#125;by&#123;&#123; post_value.author &#125;&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &#123;&#123; post_value.body|linebreaks &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="【问题汇总】："><a href="#【问题汇总】：" class="headerlink" title="【问题汇总】："></a>【问题汇总】：</h2><ul>
<li>[1 ]  <code>File &quot;manage.py&quot;, line 14
) from exc
^
SyntaxError: invalid syntax</code></li>
</ul>
<p>解决：使用virtualenv来做环境，更改pycharm中设置的编译器地址。</p>
<ul>
<li><p>[ 2] <code>You are trying to add a non-nullable field &#39;author&#39; to post without a default; we can&#39;t do that (the database needs something to populate existing rows)</code><br>解决：在每个报错字段的后面加一个default=””即可</p>
</li>
<li><p>[ 3]<code>blog.Post.created: (fields.E160) The options auto_now, auto_now_add, and default are mutually exclusive. Only one of these options may be present</code><br>经过：因为后面追加上默认值default=timezone.now，提示auto_now_add=Ture与其不能共存，在网上一时也没找到更加合适的办法<br>解决：第一次就只加默认值，指定两步迁移到数据库表；之后去掉default再次修改为auto_now_add=Ture，迁移成功。其中：<br>DateTimeField、DateField和TimeField三种类型可以用来创建日期字段，其值分别对应着datetime()、date()、time()三中对象。这三个field有着相同的参数auto_now和auto_now_add，</p>
</li>
</ul>
<p>-[ 4]pycharm添加env python编译环境</p>
<p>setting-project中可添加和删除编译环境选项<br><img src="/images/pasted-19.png" alt="upload successful"><br>使用Pycharm给其配置编译器,提示pycharm配置虚拟环境    Envirement  location directory is not empty<br>解决办法：将原来的代码里错误环境的目录找到，然后将venv删掉，再重新进来进行如下配置就没问题了<br><img src="/images/pasted-20.png" alt="upload successful"></p>
<p>配置完成后，还是不对<br><img src="/images/pasted-21.png" alt="upload successful"></p>
<p><img src="/images/pasted-22.png" alt="upload successful"><br>换成下面的Existing environment成功<br><img src="/images/pasted-23.png" alt="upload successful"><br>配置项目，编译器改成刚才Pycharm设置好的那个</p>
<p><img src="/images/pasted-25.png" alt="upload successful"></p>
<p><img src="/images/pasted-24.png" alt="upload successful"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/22/awk知识点汇总/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="躲不掉的风">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="躲不掉的风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/22/awk知识点汇总/" itemprop="url">awk知识点汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-22T15:23:35+08:00">
                2018-08-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考原文：<a href="https://blog.csdn.net/liang5603/article/details/80855426" target="_blank" rel="noopener">https://blog.csdn.net/liang5603/article/details/80855426</a></p>
<p>grep sed awk 被称为linux中的“三剑客”<br>grep更适合单纯的查找或匹配文本<br>sed更适合编辑匹配到的文本<br>awk更适合格式化文本，对文本进行较复杂格式处理</p>
<h5 id="awk语法："><a href="#awk语法：" class="headerlink" title="awk语法："></a>awk语法：</h5><pre><code>awk [options] &apos;commands&apos; filenames

- options:-F 定义输入字段分隔符，默认的分隔符是空格或制表符(tab)
- command:

    BEGIN{} {} END{}
    行处理前 行处理 行处理后</code></pre><p>  例：      </p>
<pre><code>$ awk &apos;BEGIN{print &quot;begin:&quot;1/2}{print &quot;ok&quot;}END{print&quot;--ending-&quot;}&apos; vimtest.txt 
begin:0.5
ok
ok
--ending-    </code></pre><h5 id="awk执行原理"><a href="#awk执行原理" class="headerlink" title="awk执行原理"></a>awk执行原理</h5><ol>
<li>awk 使用一行作为输入，并将这一行赋给内部变量$0，每一行也可称为一个记录，以换行符结束</li>
</ol>
<ul>
<li>(2)然后，行被: (默认为空格或制表符)分解成字段(或域)，每个字段存储在已编号的变量中，从$1 开始，最多达 100 个字段</li>
<li>(3)awk 如何知道用空格来分隔字段的呢? 因为有一个内部变量 FS 来确定字段分隔符。初始 时，FS 赋为空格</li>
<li>(4)awk 打印字段时，将以设置的方法使用 print 函数打印，打印时逗号映射为OFS默认为空格</li>
</ul>
<h5 id="字段解释"><a href="#字段解释" class="headerlink" title="字段解释"></a>字段解释</h5><pre><code>$0: awk 变量$0 保存当前记录的内容 # awk -F: &apos;{print $0}&apos; /etc/passwd
NR: The total number of input records seen so far. # awk -F: &apos;{print NR, $0}&apos; /etc/passwd /etc/hosts  （序号值）
FNR: The input record number in the current input file # awk -F: &apos;{print FNR, $0}&apos; /etc/passwd /etc/hosts
NF: 保存记录的字段数，$1,$2...$100 # awk -F: &apos;{print $0,NF}&apos; /etc/passwd
$NF:因为NF是数字，这个就是最大数的变量值即最后一个字段值
FS: 输入字段分隔符，默认空格 # awk -F: &apos;/alice/{print $1, $3}&apos; /etc/passwd
# awk -F&apos;[ :\t]&apos; &apos;{print $1,$2,$3}&apos; /etc/passwd
# awk &apos;BEGIN{FS=&quot;:&quot;} {print $1,$3}&apos; /etc/passwd
OFS: 输出字段分隔符 # awk -F: &apos;/alice/{print $1,$2,$3,$4}&apos; /etc/passwd
# awk &apos;BEGIN{FS=&quot;:&quot;; OFS=&quot;+++&quot;} /^root/{print $1,$2,$3,$4}&apos; /etc/passwd
RS The input record separator, by default a newline. # awk -F: &apos;BEGIN{RS=&quot; &quot;} {print $0}&apos; a.txt
ORS The output record separator, by default a newline. # awk -F: &apos;BEGIN{ORS=&quot;&quot;} {print $0}&apos; passwd</code></pre><ul>
<li><p>awk是<strong>逐行</strong>处理的，处理完一行再处理下一行，默认以“换行符”为标记，识别每一行。   </p>
</li>
<li><p><strong>awk可用于拼接</strong>。被拼接字符串用双引号括起来 如：awk’{print “column1:”$1,”column2:”$2}’,注意$1这种内置变了不能使用双引号，否则被当做普通文本输出。</p>
</li>
<li><p><strong>awk变量</strong>: 分为<strong>内置变量</strong>和自定义变量</p>
</li>
<li><p><strong>过滤操作</strong> ：结合运算符在action中判断如awk ‘$1&gt;20’ log.txt 输出第一列值大于2的记录</p>
</li>
</ul>
<blockquote>
<p>细心如你一定注意到了一个细节，就是在打印 $0 , $1, $2 这些内置变量的时候，都有使用到”$”符号，但是在调用 NR , NF 这些内置变量的时候，就没有使用”$”，如果你有点不习惯，那么可能是因为你已经习惯了使用bash的语法去使用变量，在bash中，我们在引用变量时，都会使用$符进行引用，但是在awk中，只有在引用$0、$1等内置变量的值的时候才会用到”$”,引用其他变量时，不管是内置变量，还是自定义变量，都不使用”$”,而是直接使用变量名。</p>
</blockquote>
<h6 id="匹配记录"><a href="#匹配记录" class="headerlink" title="匹配记录"></a>匹配记录</h6><pre><code># awk -F: &apos;$1 ~ /^alice/&apos; /etc/passwd
# awk -F: &apos;$NF !~ /bash$/&apos; /etc/passwd</code></pre><h6 id="比较表达式"><a href="#比较表达式" class="headerlink" title="比较表达式"></a>比较表达式</h6><p>条件表达式</p>
<pre><code># awk -F: &apos;$3&gt;300 {print $0}&apos; /etc/passwd
# awk -F: &apos;{ if($3&gt;300) print $0 }&apos; /etc/passwd
# awk -F: &apos;{ if($3&gt;300) {print $0} }&apos; /etc/passwd
# awk -F: &apos;{ if($3&gt;300) {print $3} else{print $1} }&apos; /etc/passwd</code></pre><p>算数运算</p>
<pre><code># awk -F: &apos;$3 * 10 &gt; 500&apos; /etc/passwd
# awk -F: &apos;{ if($3*10&gt;500){print $0} }&apos; /etc/passwd</code></pre><p>逻辑运算</p>
<pre><code># awk -F: &apos;$1~/root/ &amp;&amp; $3&lt;=15&apos; /etc/passwd # awk -F: &apos;$1~/root/ || $3&lt;=15&apos; /etc/passwd
# awk -F: &apos;!($1~/root/ || $3&lt;=15)&apos; /etc/passwd</code></pre><h6 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h6><pre><code>awk -F: &apos;{if($3==0){i++} else if($3&gt;999){k++} else{j++}} END{print i; print k; print j}&apos; /etc/passwd

[root@tianyun ~]# awk -F: &apos;{i=1; while(i&lt;=10) {print $0; i++}}&apos; /etc/passwd //将每行打印 10 次

[root@tianyun ~]# awk -F: &apos;{ for(i=1;i&lt;=10;i++) {print $0} }&apos; /etc/passwd //将每行打印 10 次</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/12/常用的web服务器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="躲不掉的风">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="躲不掉的风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/12/常用的web服务器/" itemprop="url">常用的web服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-12T19:45:21+08:00">
                2018-08-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考：<a href="http://www.coozhi.com/youxishuma/g4/63698.html" target="_blank" rel="noopener">http://www.coozhi.com/youxishuma/g4/63698.html</a></p>
<ol>
<li>Apache<br>也被叫做httpd服务器，是目前使用<strong>最广泛的</strong>web服务器。<br>优点：小巧，灵活，可扩展，稳定<br>缺点：软件开源，漏洞易被发现</li>
<li>Nginx<br>是<strong>Linux</strong>平台下优秀的web服务器.不仅是HTTP服务器而且也是负载均衡的反向代理。<br>优点：压缩率高，支持负载均衡，<strong>速度快</strong></li>
<li>IIS<br>IIS是微软平台的web服务器，是针对windows平台的服务器。和NET非常搭配<br>优点：安装配置简单，学起来容易<br>缺点：平台适用性单一，安全性有待提高</li>
<li>Tomcat<br>免费，深受java开发者喜爱。<br>优点：简单易掌握，部署容易，应用广泛<br>缺点：扩展性不强，可配置性弱，大并发能力不强</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/09/python语法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="躲不掉的风">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="躲不掉的风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/09/python语法/" itemprop="url">语法_python3记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-09T17:29:00+08:00">
                2018-08-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="矩阵乘法"><a href="#矩阵乘法" class="headerlink" title="矩阵乘法"></a>矩阵乘法</h4><p>分为两种方式</p>
<p>1.np.dot(A,B)</p>
<ul>
<li>对于多维矩阵，计算真正意义上的矩阵乘积(数学线性运算)</li>
<li>对于一维矩阵，计算内积</li>
</ul>
<p>2.np.multiply()或*</p>
<p>实现对应元素直接相乘，即mn和m<em>n相乘得到的还是m</em>n的矩阵</p>
<p><a href="https://www.cnblogs.com/hezhiyao/p/8177832.html" target="_blank" rel="noopener">https://www.cnblogs.com/hezhiyao/p/8177832.html</a></p>
<pre><code>import numpy as np
xx =np.array([[-1, 0, 1],[-2, 0, 2]])
yy =np.array([[-1, 0, 1],[-2, 0, 2]])
rt=xx*yy
count=sum(rt) #每列相加
print(rt)
print(count)
print(sum(count))

返回值
[[1 0 1]
[4 0 4]]

[5 0 5]
10</code></pre><h4 id="字符串判定"><a href="#字符串判定" class="headerlink" title="字符串判定"></a>字符串判定</h4><pre><code>isalnum()数字或字母
isalpha()字母
isdigit()数字
isupper()大写
istitle()首字母大写
isspace()所有字母都是空白字符、\t、\n、\r</code></pre><h4 id="max函数"><a href="#max函数" class="headerlink" title="max函数"></a>max函数</h4><p>1)除了数值类型，字符串取字母表最靠后的字母</p>
<p>2）可以添加参数key，指定方法，入参即为比较的元素</p>
<pre><code>sample=[40,53,12,5,5,9,9]
print(max(set(sample), key=sample.count))</code></pre><h4 id="yield和斐波那契数列"><a href="#yield和斐波那契数列" class="headerlink" title="yield和斐波那契数列"></a>yield和斐波那契数列</h4><p>比如爬楼梯和生兔子问题都是斐波那契数列问题。我的理解比如爬楼梯要么从下两层爬上来，要么就是从下1层爬上来，一共两种方式，肯定就是这两种方法的总和，兔子问题需要推出来符合斐波那契数列数列规律。</p>
<pre><code>def fab(max):
a,b,n=0,1,0
while(n&lt;max):
    yield b
    print(&quot;aaa&quot;)
    a,b=b,a+b
    n+=1
f=fab(5)
print(f.__next__())#1
print(f.__next__())#aaa 1
print(f.__next__())#aaa 2</code></pre><p> yield：返回值b；每次调用<strong>next</strong>()的时候执行到此关键字处。下次<strong>next</strong>()再继续执行yeild后面的语句。</p>
<p> 因为是迭代器，所以可以改成遍历获取：</p>
<pre><code>for i in fab(5):
   print (i)</code></pre><p> 对于斐波那契数列还可以使用装饰器进行优化：</p>
<pre><code> def cache(fun):
    fibdict = {}
    print (&quot;cache begin..&quot;)
    def wrapper(n):

        if n in fibdict:
            return fibdict[n]
        fibdict[n]=fun(n)
        return fibdict[n]
    return wrapper
@cache
def fib(n):
    return 1 if n &lt;2 else fib(n-1)+fib(n-2)

print(fib(7))</code></pre><h4 id="re-search和re-match"><a href="#re-search和re-match" class="headerlink" title="re.search和re.match"></a>re.search和re.match</h4><p>前者从整个字符串中寻找一个匹配，后者只匹配字符串的开始。</p>
<pre><code>import re
a=&quot;worldhellodfddjhello&quot;
print(re.match(&quot;hello&quot;,a).group())#None
print(re.search(&quot;hello&quot;,a).group())#hello</code></pre><h4 id="dict-fromkeys-seq-value"><a href="#dict-fromkeys-seq-value" class="headerlink" title="dict.fromkeys(seq,value)"></a>dict.fromkeys(seq,value)</h4><p>或{}.fromkeys(seq,value)</p>
<p>取序列元素作为key，value作为默认值(无value就是None)</p>
<p>【注意】：这个方法因为是创建字典，所以会自动去重</p>
<pre><code>a = [1,5,5,7]
print(dict.fromkeys(a,&quot;defaultvalue&quot;))

#输出
{1: &apos;defaultvalue&apos;, 5: &apos;defaultvalue&apos;, 7: &apos;defaultvalue&apos;}

 list({}.fromkeys(plist).keys())</code></pre><h4 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h4><pre><code>read():读取整个文件，内容为字符串
readline()：返回下一行，内容为字符串；
readlines():返回list,保存有每行的数据。</code></pre><h4 id="下划线命名"><a href="#下划线命名" class="headerlink" title="下划线命名"></a>下划线命名</h4><p>python中主要存在四种命名方式：</p>
<p>1、object #无下划线：公用方法</p>
<p>2、_object #单下划线：半保护</p>
<pre><code>被看作是“protect”，意思是只有类对象和子类对象自己能访问到这些变量，
 在模块或类外不可以使用，不能用’from module import *’导入。
__object 是为了避免与子类的方法名称冲突， 对于该标识符描述的方法，父
类的方法不能轻易地被子类的方法覆盖，他们的名字实际上是_classname__methodname。</code></pre><p>3、__object  #双下划线：全私有，全保护</p>
<pre><code>私有成员“private”，意思是只有类对象自己能访问，连子类对象也不能访问到这个数据，不能用’from module import *’导入。</code></pre><p>4、_ _ object_ _     #前后都有双下划线：内建方法，用户不要这样定义</p>
<h4 id="jsonpath模块"><a href="#jsonpath模块" class="headerlink" title="jsonpath模块"></a>jsonpath模块</h4><p>安装pip install jsonpath</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from jsonpath import jsonpath</span><br><span class="line"></span><br><span class="line">testdict=&#123;</span><br><span class="line">    &quot;config&quot;: &#123;</span><br><span class="line">        &quot;host_huidu&quot;: &quot;10.39.34.70:8080&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;name&quot;: &quot;hotel&quot;,</span><br><span class="line">    &quot;groups&quot;: &#123;</span><br><span class="line">        &quot;order&quot; : [</span><br><span class="line">            &quot;/hotel/getHomepageOrderList&quot;,</span><br><span class="line">            &quot;/myelong/getHotelOrder&quot;,</span><br><span class="line">            &quot;/myelong/getHotellist&quot;</span><br><span class="line">        ]        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ret=jsonpath(testdict,&quot;$.name&quot;)</span><br><span class="line">ret=jsonpath(testdict,&quot;$.groups.order[1]&quot;)</span><br><span class="line">ret=jsonpath(testdict,&quot;$..order[1:3]&quot;)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>

<h4 id="单例（Singleton）"><a href="#单例（Singleton）" class="headerlink" title="单例（Singleton）"></a>单例（Singleton）</h4><p>单例是一种设计模式，应用该模式的类只会生成一个实例</p>
<p>在 Python 中，我们可以用多种方法来实现单例模式：</p>
<ul>
<li><p>使用模块</p>
</li>
<li><p>使用 <strong>new</strong></p>
</li>
<li><p>使用装饰器（decorator）</p>
</li>
<li><p>使用元类（metaclass）</p>
</li>
</ul>
<p>重写new函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 实例化一个单例</span><br><span class="line">class Singleton():</span><br><span class="line">    __instance = None</span><br><span class="line"> </span><br><span class="line">    def __new__(cls, age, name):</span><br><span class="line">        #如果类属性__instance的值为None，</span><br><span class="line">        #那么就创建一个对象，并且赋值为这个对象的引用，保证下次调用这个方法时</span><br><span class="line">        #能够知道之前已经创建过对象了，这样就保证了只有1个对象</span><br><span class="line">        if not cls.__instance:</span><br><span class="line">            cls.__instance = super().__new__(cls)</span><br><span class="line">        return cls.__instance</span><br><span class="line"> </span><br><span class="line">a = Singleton(18, &quot;dongGe&quot;)</span><br><span class="line">b = Singleton(8, &quot;dongGe&quot;)</span><br><span class="line"> </span><br><span class="line">print(id(a))</span><br><span class="line">print(id(b))</span><br></pre></td></tr></table></figure>

<p>【注】 区别:cls是类本身的一个对象,self是类实例的一个对象</p>
<p>参考：<a href="https://segmentfault.com/a/1190000008141049" target="_blank" rel="noopener">https://segmentfault.com/a/1190000008141049</a></p>
<h4 id="python-赋值-深拷贝-浅拷贝"><a href="#python-赋值-深拷贝-浅拷贝" class="headerlink" title="python 赋值 深拷贝    浅拷贝"></a>python 赋值 深拷贝    浅拷贝</h4><pre><code>浅拷贝：即引用，共用一个地址，互相受影响。  
深拷贝：完全独立的地址，互相不受影响。  
赋值：字典，列表等对象赋值相当于浅拷贝，而int,str,float,bool在值改变后新增了内存地址存放新值，与原来不共用一个地址，相当于深拷贝。  </code></pre><p>一般默认是浅拷贝，有速度快，占用内存小等特点</p>
<h4 id="yaml模块"><a href="#yaml模块" class="headerlink" title="yaml模块"></a>yaml模块</h4><ol>
<li>安装：pip install pyyaml  </li>
</ol>
<p>  *<em>语法 *</em>：  </p>
<ol>
<li><p>大小写敏感 </p>
</li>
<li><p>使用缩进表示层级关系</p>
</li>
<li><p>缩进时不允许使用Tab，只允许使用空格</p>
</li>
<li><p>缩进的空格数目不重要，只要相同层级的元素左对齐即可</p>
</li>
<li><p>‘#’表示注释，从它开始到行尾都被忽略</p>
<p>yaml模块常用的两个方法时yaml.load和yaml.dump</p>
<ol start="2">
<li>yaml.load<br>返回一个对象dict</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import yaml</span><br><span class="line">f = open(r&apos;E:\AutomaticTest\Test_Framework\config\config.yml&apos;)</span><br><span class="line">y = yaml.load(f)</span><br><span class="line">print (y)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>yaml.dump 将一个python对象生成为yaml文档,除此还有safe_dump等<br>若有中文，必须添加<strong>allow_unicode</strong>参数<br>第二个参数，是要写进的文件</p>
<p> dump(data, stream=None, Dumper=Dumper,<br>   default_style=None,<br>   default_flow_style=None,<br>   encoding=’utf-8’, # encoding=None (Python 3)<br>   explicit_start=None,<br>   explicit_end=None,<br>   version=None,<br>   tags=None,<br>   canonical=None,<br>   indent=None,<br>   width=None,<br>   allow_unicode=None,<br>   line_break=None)<br> dump_all(data, stream=None, Dumper=Dumper, …)  </p>
<p> safe_dump(data, stream=None, …)  </p>
<p> safe_dump_all(data, stream=None, …)  </p>
</li>
</ol>
</li>
</ol>
<p>举例：<br>      import yaml<br>      with open(‘abc.conf’,’w’)as f:<br>         yaml.dump(self.config, f, default_flow_style=False,<br>         indent=2, allow_unicode=True)<br>      <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSON转YAML</span><br></pre></td></tr></table></figure></p>
<pre><code>import json,yaml
str = &apos;{ &quot;foo&quot;: &quot;bar&quot; }&apos;
data = json.loads(str)
yml = yaml.safe_dump(data,allow_unicode=True)
print(yml)</code></pre><p>  参考：<a href="http://www.361way.com/python-pyyaml-module/4271.html" target="_blank" rel="noopener">http://www.361way.com/python-pyyaml-module/4271.html</a><br>  参考：<a href="https://www.cnblogs.com/klb561/p/9326677.html" target="_blank" rel="noopener">https://www.cnblogs.com/klb561/p/9326677.html</a></p>
<h4 id="json模块"><a href="#json模块" class="headerlink" title="json模块"></a>json模块</h4><ol>
<li><p>json.dumps[卸载掉对象]   </p>
<p> 把一个Python对象编码转换成—&gt;json<strong>字符串</strong></p>
</li>
<li><p>json.loads[装上对象]    </p>
<p>   把json字符串解码转换成—&gt;python<strong>对象dict</strong></p>
<p>   其中 json 有下面三种样式：</p>
<p> 字典样式 ‘{“name”:”gzj”, “age”:”23”, “sex”:”man”}’<br> 列表样式 ‘[“gzj”, 23, “man”]’<br> 字典和列表相互嵌套的样式 “””[“gzj”, “{‘age’:’23’}”]”””<br> 特别注意 JSON 字符串中的内容用双引号，而非单引号。</p>
</li>
<li><p>json.dump和json.load均是针对文件的。<br>json.dump<br>我理解为两个动作，一个动作是将”obj“转换为JSON格式的字符串，还有一个动作是将字符串写入到文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;&quot;name&quot;:&quot;Tom&quot;, &quot;age&quot;:23&#125;</span><br><span class="line">with open(&quot;test.json&quot;, &quot;w&quot;, encoding=&apos;utf-8&apos;) as f:</span><br><span class="line">  ... # Parameter sort_keys    是否按照字母排序</span><br><span class="line">   ... # Parameter indent       缩进的空格数</span><br><span class="line">   ... # Parameter separators   分割符号形式</span><br><span class="line">     json.dump(a,f,indent=4) </span><br><span class="line">   # indent 超级好用，格式化保存字典，默认为None，小于0为零个空格</span><br><span class="line">   # f.write(json.dumps(a, indent=4))</span><br><span class="line">   # 和上面的效果一样！！！</span><br></pre></td></tr></table></figure>

<p>json.load<br>一个动作是将一个包含JSON格式数据从文件中取出来，还有一个动作是将其序列化为一个python对象dict</p>
<p><strong>当打开文件的时候，注意加上encoding否则会因为中文报错！</strong></p>
<p>import json<br>with open(“test.json”, “r”, encoding=’utf-8’) as f:<br>   aa = json.loads(f.read())<br>   f.seek(0)<br>   bb = json.load(f)    # 与 json.loads(f.read())</p>
</li>
</ol>
<h4 id="encode-和decode"><a href="#encode-和decode" class="headerlink" title="encode 和decode"></a>encode 和decode</h4><p>这里只说python3,不谈python2</p>
<pre><code>- 字符串通过编码转换为字节码，字节码通过解码转换为字符串   </code></pre><p>   str（unicode）—&gt;(encode)—&gt;bytes，bytes—&gt;(decode)—&gt;str </p>
<p>   python3默认编码是unicode编码，非utf8,需要经过encode才可能到utf8.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=&quot;小明&quot;   #类型：&lt;class &apos;str&apos;&gt;</span><br><span class="line">name1=name.encode(&quot;utf-8&quot;)  #加密输出：b&apos;\xe5\xb0\x8f\xe6\x98\x8e&apos;</span><br><span class="line">name2=name1.decode(&quot;utf-8&quot;) #解密还原：&apos;小明&apos;</span><br></pre></td></tr></table></figure>

<p>   u’\u7b80’ 是unicode, ‘\xe7\xae\x80’是byte , byte和unicode之间一一对应, 可以相互转换, 转换规则如下:<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;b&apos;\xe7\xae\x80&apos;.decode(&apos;utf-8&apos;)   #字节转unicode（str）</span><br><span class="line">&apos;简&apos;</span><br><span class="line">&gt;&gt;&gt;u&apos;\u7b80&apos;.encode(&apos;utf-8&apos;)    #unicode转字节</span><br><span class="line">b&apos;\xe7\xae\x80&apos;</span><br></pre></td></tr></table></figure></p>
<p>   参考：<a href="https://www.jianshu.com/p/4ced2bbc9334" target="_blank" rel="noopener">https://www.jianshu.com/p/4ced2bbc9334</a><br>   <a href="https://blog.csdn.net/qq_29053519/article/details/79170519" target="_blank" rel="noopener">https://blog.csdn.net/qq_29053519/article/details/79170519</a></p>
<h4 id="装饰器和闭包"><a href="#装饰器和闭包" class="headerlink" title="装饰器和闭包"></a>装饰器和闭包</h4><p>  自定义装饰器，常用作打日志和运行时间</p>
<pre><code>import time
def logger(func):
    #如果原函数有参数，那闭包函数必须保持参数个数一致
    def mywrapper(x,y):#将函数外面包一层
        print(x,y)#添加的额外功能,打印日志(1,2)
        t1=time.time()
        func(x,y)#原函数add(a,b)
        t2=time.time()
        cost=t2-t1#额外功能：计算时间
        print(&quot;共计花费时间{}&quot;.format(cost))
    return mywrapper

@logger
def add(a,b):
    print(&quot;a+b={}&quot;.format(a+b))
    time.sleep(1)
add(1,2) #相当于logger(add)</code></pre><p>  装饰器属于闭包函数：什么是闭包函数？</p>
<h5 id="闭包函数"><a href="#闭包函数" class="headerlink" title="闭包函数"></a>闭包函数</h5><pre><code>1.函数内部定义的函数  
2.包含对外部变量而非全局变量的引用，如：

def outer():
    x = 1
    def inner():
      print(&quot;x=%s&quot; %x)
      print(&quot;inner func excuted&quot;)
    inner()#也可以return
  print(&quot;outer func excuted&quot;)

outer()

#####输出结果#########
x=1
inner func excuted
outer func excuted</code></pre><p>   闭包函数,它必须包含自己的函数以及一个外部变量才能真正称得上是一个闭包函数。如果没有一个外部变量与其绑定,那么這个函数不能算得上是闭包函数.</p>
<p>   有了以上基础,对于装饰器就好理解了. </p>
<h5 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h5><p>   外部函数传入被装饰函数名，内部函数返回装饰函数名。</p>
<pre><code>  特点：  
     1.不修改被装饰函数的调用方式   
     2.不修改被装饰函数的源代码

import time
import random

def timmer(func):
    def wrapper():
        start_time = time.time()
        func()
        stop_time=time.time()
        print(&apos;run time is %s&apos; %(stop_time-start_time))
    return wrapper
def auth(func):
    def deco():
        name=input(&apos;name: &apos;)
        password=input(&apos;password: &apos;)
        if name == &apos;egon&apos; and password == &apos;123&apos;:
            print(&apos;login successful&apos;)
            func() #wrapper()
        else:
            print(&apos;login err&apos;)
    return deco

@auth   # index = auth(timmer(index))                 
@timmer # index = timmer(index)
def index():

  time.sleep(3)
  print(&apos;welecome to index page&apos;)
index()</code></pre><p>   如果有多个引用如上面的@auth,@timmer,顺序是从下至上。</p>
<p>   参考：<a href="https://www.cnblogs.com/huchong/p/7725564.html#_label1" target="_blank" rel="noopener">https://www.cnblogs.com/huchong/p/7725564.html#_label1</a></p>
<h4 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h4><pre><code>https://www.cnblogs.com/lvcm/p/8859225.html这篇文章总结的很好</code></pre><h4 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h4><p> python3常用的两个模块为：</p>
<ul>
<li>_thread</li>
<li>threading(推荐使用)</li>
</ul>
<p>线程中参数传递方法：</p>
<pre><code>1、仅使用元组传递初始化
    threading.Thread(target=song,args=(1,2,3)).start()
2、仅使用字典传递 threading.Thread(target=方法名, kwargs={&quot;参数名&quot;: 参数1, &quot;参数名&quot;: 参数2, ...})

threading.Thread(target=song,kwargs={&quot;a&quot;:1,&quot;c&quot;:3,&quot;b&quot;:2}).start() #参数顺序可以变
3、混合使用元组和字典 threading.Thread(target=方法名，args=（参数1, 参数2, ...）, kwargs={&quot;参数名&quot;: 参数1,&quot;参数名&quot;: 参数2, ...})

threading.Thread(target=song,args=(1,),kwargs={&quot;c&quot;:3,&quot;b&quot;:2}).start()</code></pre><p>   主要参数：</p>
<pre><code>target表示调用对象 , 即子进程要执行的任务  
args表示调用对象的位置参数,元组类型。  </code></pre><p>  方法介绍：    </p>
<pre><code>p.start() : 启动进程,并调用子进程中的p.run ()  
p.is_alive () : 如果p仍然运行 , 返回True</code></pre><p>threading参考：<a href="https://www.jb51.net/article/161728.htm" target="_blank" rel="noopener">https://www.jb51.net/article/161728.htm</a></p>
<h4 id="处理小数"><a href="#处理小数" class="headerlink" title="处理小数"></a>处理小数</h4><p>参考：<a href="https://www.jb51.net/article/102248.htm" target="_blank" rel="noopener">https://www.jb51.net/article/102248.htm</a></p>
<ul>
<li><p>向下取整 int()</p>
</li>
<li><p>四舍五入 round()</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; round(3.25); round(4.85)</span><br><span class="line">3.0</span><br><span class="line">5.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>向上取整 ceil()</p>
</li>
<li><p>分别取整数部分和小数部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import math</span><br><span class="line">&gt;&gt;&gt; math.modf(3.25)</span><br><span class="line">(0.25, 3.0)</span><br><span class="line">&gt;&gt;&gt; math.modf(4.2)</span><br><span class="line">(0.20000000000000018, 4.0)</span><br><span class="line">&gt;&gt;&gt;b = math.modf(123.34)#分开两部分</span><br><span class="line">&gt;&gt;&gt;print(b)                </span><br><span class="line">&gt;&gt;&gt;print(&apos;%.2f&apos; % b[0]) #保留两位小数0.34</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="string模块"><a href="#string模块" class="headerlink" title="string模块"></a>string模块</h4><pre><code>import string
string.ascii_lowercase  #打印所有的小写字母
string.ascii_uppercase  #打印所有的大写字母
string.ascii_letters #打印所有的大小写字母
string.digits  #打印0-9的数字
string.punctuation  #打印所有的特殊字符

string.hexdigits #打印十六进制的字符
string.printable  #打印所有的大小写，数字，特殊字符</code></pre><h4 id="hashlib模块"><a href="#hashlib模块" class="headerlink" title="hashlib模块"></a>hashlib模块</h4><pre><code>python的hashlib库的md5摘要是不可反解的，非常安全

  hash.update(arg)
  更新hash对象。连续的调用该方法相当于连续的追加更新。例如m.update(a); m.update(b)相当于m.update(a+b)。  
  hash.digest() 返回摘要，作为二进制数据字符串值,  
  hash.hexdigest() 返回摘要，作为十六进制数据字符串值,  
  hash.copy() 复制  </code></pre><p>示例：加盐</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def my_md5(s:str,salt=None):</span><br><span class="line">s=str(s)</span><br><span class="line">if salt:</span><br><span class="line">  s=s+salt</span><br><span class="line">m=hashlib.md5(s.encode())</span><br><span class="line">return m.hexdigest()</span><br></pre></td></tr></table></figure>

<p> 或</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> import hashlib</span><br><span class="line">obj=hashlib.md5(b&apos;12334&apos;)                #实例化md5的时候可以给传个参数，这叫加盐</span><br><span class="line">obj.update(&quot;admin&quot;.encode(&quot;utf-8&quot;))      #是再加密的时候传入自己的一块字节，</span><br><span class="line">secret=obj.hexdigest()</span><br><span class="line">print(secret)</span><br></pre></td></tr></table></figure>

<h4 id="局部变量和全局变量"><a href="#局部变量和全局变量" class="headerlink" title="局部变量和全局变量"></a>局部变量和全局变量</h4><h6 id="列表-字典-集合-类-—-局部变量可以改全局变量，除了整数和字符串"><a href="#列表-字典-集合-类-—-局部变量可以改全局变量，除了整数和字符串" class="headerlink" title="列表 字典 集合 类 —-局部变量可以改全局变量，除了整数和字符串"></a>列表 字典 集合 类 —-局部变量可以改全局变量，除了整数和字符串</h6>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;&#125;</span><br><span class="line">def test():</span><br><span class="line">    d[&apos;url&apos;]=&apos;https://www.cnblogs.com/uncleyong/p/10530261.html&apos;</span><br><span class="line">def test2():</span><br><span class="line">    d[&apos;url&apos;]=&apos;https://www.cnblogs.com/uncleyong/&apos;</span><br><span class="line">test()</span><br><span class="line">test2()</span><br><span class="line">print(d)</span><br><span class="line">#&#123;&apos;url&apos;: &apos;https://www.cnblogs.com/uncleyong/&apos;&#125;</span><br></pre></td></tr></table></figure>

<p>但是如果重新创建则不是一回事</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">info =&#123;&apos;age&apos;:18,  &apos;url&apos;:&apos;https://www.cnblogs.com/uncleyong/p/10530261.html&apos;&#125;</span><br><span class="line">def test():</span><br><span class="line">    #重新创建了一个区别全局info的变量（地址变了，可用id函数验证）		</span><br><span class="line">    info=&#123;&#125;</span><br><span class="line">    info[&apos;name&apos;] = &apos;qzcsbj&apos;</span><br><span class="line">test()</span><br><span class="line">print(info)</span><br><span class="line">#&#123;&apos;age&apos;: 18, &apos;url&apos;: &apos;https://www.cnblogs.com/uncleyong/p/10530261.html&apos;&#125;</span><br></pre></td></tr></table></figure>

<h6 id="global"><a href="#global" class="headerlink" title="global"></a>global</h6><p>  global需要在局部变量定义之前声明，否则报错</p>
<pre><code>res = None
def calc(a,b):
    res = 0
    global res
    res = a+b
calc(1,2)
print(res)
#报错:SyntaxError: name &apos;res&apos; is assigned to before global declaration</code></pre><p>　　</p>
<h4 id="random模块"><a href="#random模块" class="headerlink" title="random模块"></a>random模块</h4><p> random中的一些重要函数的用法：</p>
<pre><code>random.random()函数是这个模块中最常用的方法了，它会生成一个随机的浮点数，范围是在0.0~1.0之间。

random.uniform()正好弥补了上面函数的不足，它可以设定浮点数的范围，一个是上限，一个是下限。

random.randint()随机生一个整数int类型，可以指定这个整数的范围，同样有上限和下限值，如random.randint（0，4）包括0和4中的随机整数。

random.choice()可以从任何序列，比如list列表中，选取一个随机的元素返回，可以用于字符串、列表、元组等。

random.sample()可以从指定的序列中，随机的截取指定长度的片断，不作原地修改。</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/08/Django项目实践一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="躲不掉的风">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="躲不掉的风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/08/Django项目实践一/" itemprop="url">Django问题记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-08T19:53:45+08:00">
                2018-08-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><p>本机之前一直装的是2.7，但是现在3.x已然成为趋势，准备更新3.7</p>
<p>   windows:</p>
<p>  下载python最新版本逐步进行安装（一定要选中pip）<br>     安装requests，直接pip install requests即可。<br>    Python 下载地址：<a href="https://www.python.org/downloads/" target="_blank" rel="noopener">https://www.python.org/downloads/</a></p>
<p>  Linux(centos 6.4):<br> 参考： <a href="https://www.cnblogs.com/dukuan/p/8252019.html" target="_blank" rel="noopener">https://www.cnblogs.com/dukuan/p/8252019.html</a><br>    wget <a href="https://www.python.org/ftp/python/3.4.4/Python-3.4.4.tgz" target="_blank" rel="noopener">https://www.python.org/ftp/python/3.4.4/Python-3.4.4.tgz</a></p>
<pre><code>ls
tar xf Python-3.4.4.tgz 
mkdir /usr/local/python3
cd Python-3.4.4
ls
./configure --prefix=/usr/local/python3
make all
make install</code></pre><ul>
<li><p>下载Django，并安装<br>Django 下载地址：<a href="https://www.djangoproject.com/download/" target="_blank" rel="noopener">https://www.djangoproject.com/download/</a><br>解压缩后安装：<br>   D:\下载\Django-2.1.7\Django-2.1.7&gt;python setup.py install<br>   将这几个目录添加到系统环境变量中如： C:\Python33\Lib\site-packages\django;C:\Python33\Scripts。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import django    #检查</span><br><span class="line">&gt;&gt;&gt; django.get_version()</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载 安装pycharm专业版<br> 打开 <a href="http://idea.lanyus.com/" target="_blank" rel="noopener">http://idea.lanyus.com/</a></p>
<h4 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h4></li>
<li><p>创建项目，使用自己机器上的python编译器。添加app名称，IDE会默认创建app相关文件和配置。<br><img src="https://img-blog.csdnimg.cn/2019022014425410.png" alt="在这里插入图片描述"></p>
</li>
<li><p>启动服务<br>在开发阶段，为了能够快速预览到开发的效果，django提供了一个纯python编写的轻量级web服务器，仅在开发阶段使用<br>可以在Terminal运行如下命令启动服务器：<br>python manage.py runserver（默认127.0.0.1:8000 也可以使用0.0.0.0:8888这样可以再其他机器访问此端口的这个服务）<br><img src="https://img-blog.csdnimg.cn/20190220145321590.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVyX2NoZW5seQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>如果增加、修改、删除python文件，服务器会自动重启<br>如果想关闭服务器可以使用ctrl+c或点击run窗口的红色方块按钮<br>当然可以直接在目录上启动服务，以上是为了方便开发使用。</p>
</li>
</ul>
<ul>
<li>提交表单 MultiValueDictKeyError<br><img src="https://img-blog.csdnimg.cn/20190220182153159.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVyX2NoZW5seQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">原因：<br>找了好久原因，不是语法的错误，而是逻辑错误。不应该在matrix.html页面传参，matrix是接收参数跳转的页面。解决方法就是新起了一个search.html的页面，进行传参。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def getSchedule(request):</span><br><span class="line">    context=&#123;&#125;</span><br><span class="line">    pid=request.GET[&apos;pid&apos;]</span><br><span class="line">    sid=request.GET[&apos;sid&apos;]</span><br><span class="line">    context[&quot;list&quot;]=task(pid,sid)</span><br><span class="line">    return render(request,&quot;matrix.html&quot;,context)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用openpyxl<br><a href="https://www.cnblogs.com/anpengapple/p/6399304.html" target="_blank" rel="noopener">https://www.cnblogs.com/anpengapple/p/6399304.html</a><br>eg:行添加,直接用sheet.append(rowlist)</li>
<li>AJAX的四种异步请求方式<br>简单理解jQuery中$.getJSON、$.get、$.post、$.ajax用法<br><a href="https://www.cnblogs.com/dongsh/p/3235487.html" target="_blank" rel="noopener">https://www.cnblogs.com/dongsh/p/3235487.html</a></li>
</ul>
<ul>
<li><p>模板前端与后台交互方法 $.getJSON</p>
<pre><code>$(document).ready(function () {
    $(&quot;#dl&quot;).click(function () {
        var sid=$(&quot;#sid&quot;).val();
        var pid=$(&quot;#pid&quot;).val();
    $.getJSON(&quot;/download/&quot;,{&apos;sid&apos;:sid,&apos;pid&apos;:pid},)
    });

    $(&quot;#submit&quot;).click(function () {
        var sd=$(&quot;#sid&quot;).val();
        var pd=$(&quot;#pid&quot;).val();
        $.getJSON(&quot;/getSchedule/&quot;,{&apos;sd&apos;:sd,&apos;pd&apos;:pd},function (ret) {
            $(&quot;#result&quot;).html(&quot;&quot;);
           for(var i =0;i&lt;ret.length;i++){
               $(&apos;#result&apos;).append(ret[i]).append(&quot;&lt;br&gt;&quot;)
           }
        })
    });
});</code></pre><ul>
<li>由于用 jQuery 实现 ajax 比较简单，所以我们用 jQuery库来实现</li>
<li>js调试  console.log</li>
<li>Django 后台返回<br>数组：return HttpResponse(json.dumps(a), content_type=’application/json’)<br>字典：return HttpResponse(json.dumps(name_dict), content_type=’application/json’)</li>
<li>url前面加/，指的是根目录。不加则指的是当前页面的子路径。<br><img src="https://img-blog.csdnimg.cn/20190222121737705.png" alt="在这里插入图片描述"></li>
<li>js清空标签内容：$(“#result”).html(“”)，而非$(“#result”).val(“”)<br>val是value的缩写  是给value属性赋值而已  并不是清空节点内的html元素<br>但是你如果html(‘2’)  就会变成<input type="text" value>2   虽然这个写法不对  但是这个意思</li>
</ul>
</li>
<li><p>python3.5中，import sqlite3 出现 no module named _sqlite3的解决方法<br>检查自己有没有安装sqlite-devel(rpm -qa |grep sqlite-devel) ，没有的话yum -y install sqlite-devel<br>然后进入到Python目录，（cd python目录）<br>然后命令行输入./configure，然后make和make  install<br>这个时候可以输入python，进入python环境后，import sqlite3，看还会不会报错。</p>
</li>
<li><p>ImportError: No module named openpyxl,xlrd<br>pip  install openpyxl</p>
</li>
<li><p>ImportError: No module named ‘requests’<br>pip install requests</p>
</li>
<li><p>How to fix error: django.db.utils.NotSupportedError: URIs not supported<br>这个问题浪费了很长的时间解决，首先是尝试升级qlite的版本，但是升级后依旧不能解决，最后根据提示中的目录将base.py中的字段改后解决了。即参考文章中的第一个方法。摘自:<a href="https://blog.csdn.net/zhuangmezhuang/article/details/82776272" target="_blank" rel="noopener">https://blog.csdn.net/zhuangmezhuang/article/details/82776272</a></p>
</li>
<li><p>‘WSGIRequest’ object has no attribute ‘urlopen’</p>
</li>
<li><p>views返回几种方式<br> return render_to_response(“search.html”)<br> 属于shortcuts模块，常用需要2个参数，第一个是模板如hello.html，第二个是字典，其中字典key就是模板中的变量。<br> return HttpResponse(“success!”)<br> 常用于直接返回字符串</p>
</li>
<li><p>静态文件的使用<br>settings.py 中两处注意：</p>
<ol>
<li>setting文件  </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-INSTALLED_APPS中 注册了‘django.contrib.staticfiles’，默认生成的文件已注册。 </span><br><span class="line">-指定STATIC_URL 与 STATICFILES_DIRS 的值.</span><br><span class="line"></span><br><span class="line">INSTALLED_APPS=[</span><br><span class="line">    &apos;...&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles&apos;,</span><br><span class="line">    &apos;...&apos;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">STATIC_URL=&apos;/static/&apos;</span><br><span class="line">STATICFILES_DIRS=(BASE_DIR,&apos;static&apos;)</span><br></pre></td></tr></table></figure>


</li>
</ul>
<p>  2.html文件中引用静态文件（常加在link前）：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load staticfiles %&#125;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#123;% static &apos;css/main.css&apos; %&#125;&quot; /&gt;</span><br><span class="line">...</span><br><span class="line">&#123;% static &apos;/image/test.png&apos; %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>打开text文件乱码且每次打开的时候会多出一行？</p>
<p>本地的ct.txt文件保存格式未必是utf-8，所以需要指定编码格式才更准确，使用newline防止在每次写入默认新添加一空行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=open(&quot;templates/ct.txt&quot;,&quot;w&quot;,encoding=&quot;utf-8&quot;, newline=&apos;&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>表单提交后不调view接口？<br>表单submit按钮类型写错，应该是submit类型，非button类型。</p>
</li>
<li><p>django.db.utils.IntegrityError: (1048, “Column ‘sheet_id’ cannot be null”)</p>
<p><img src="/images/pasted-143.png" alt="upload successful"></p>
<p>  找了下数据库把该字段改成自增，并保存成功(切记！)</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/07/my-first-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="躲不掉的风">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="躲不掉的风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/my-first-blog/" itemprop="url">搭建博客(blog)踩得最主要的坑</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-07T22:39:00+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用过程中博客报错：Unhandled rejection Template render error: (unknown path) [Line 9, Column 39]</p>
<p>一篇博客中带有大括号的符号导致，以后避免使用或者放在代码框中。</p>
<p><img src="/images/pasted-60.png" alt="upload successful"></p>
<h5 id="——以下是搭建过程和问题-——"><a href="#——以下是搭建过程和问题-——" class="headerlink" title="——以下是搭建过程和问题 ——-"></a>——以下是搭建过程和问题 ——-</h5><p>参考博客：<a href="https://samxrtq.github.io/2019/05/16/%E5%BB%BA%E7%AB%8BHEXO-github%E5%8D%9A%E5%AE%A2/" target="_blank" rel="noopener">https://samxrtq.github.io/2019/05/16/%E5%BB%BA%E7%AB%8BHEXO-github%E5%8D%9A%E5%AE%A2/</a></p>
<ul>
<li>问题1：<br>hexo fs.SyncWriteStream is deprecated</li>
</ul>
<p>查看各种博客，还让再安装一系列的包，最后一步步入坑，比如这种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-fs --save</span><br><span class="line">npm install hexo-deployer-git@0.3.1 --save</span><br><span class="line">npm install hexo-renderer-ejs@0.3.1 --save</span><br><span class="line">npm install hexo-server@0.2.2 --save</span><br><span class="line"></span><br><span class="line">npm audit fix</span><br></pre></td></tr></table></figure>

<p>回头来看，其实是思路除了问题，最终从头抓起，应该找到问题源头才行。最后查到了一篇对路解决方案<br><a href="https://blog.csdn.net/qq_31975963/article/details/82882465" target="_blank" rel="noopener">https://blog.csdn.net/qq_31975963/article/details/82882465</a></p>
<p>在hexo项目中其中有一个hexo-fs的插件调用了这个方法，所以需要更新hexo-fs插件，更新方法如下：</p>
<p>npm install hexo-fs –save</p>
<p>更新插件后问题依然无法解决。</p>
<p>通过–debug来查看在哪里出了问题：</p>
<p>通过–debug来查看：</p>
<p>[root@server init]# <font color="red"> hexo –debug</font><br>06:55:32.711 DEBUG Hexo version: 3.5.0<br>06:55:32.714 DEBUG Working directory: /data/wwwroot/init/<br>06:55:32.787 DEBUG Config loaded: /data/wwwroot/init/_config.yml<br>06:55:32.832 DEBUG Plugin loaded: hexo-admin<br>(node:25414) [DEP0061] DeprecationWarning: fs.SyncWriteStream is deprecated.</p>
<p>问题出在：hexo-admin的hexo-fs<br>因hexo-admin作为后台管理，无法npm uninstall hexo-admin卸载,则找到对应文件，注释：</p>
<p>打开文件<br>./node_modules/hexo-admin/node_modules/hexo-fs/lib/fs.js</p>
<p>找到 718行:exports.SyncWriteStream = fs.SyncWriteStream;<br>将对应的exports.SyncWriteStream = fs.SyncWriteStream;注释(前面 //)即可！</p>
<hr>
<p>在windows上同步搭建<br>参考：<a href="https://samxrtq.github.io/2019/05/17/Windows%E4%B8%8Emac%E5%8F%8C%E7%AB%AF%E7%94%A8hexo%E5%86%99%E5%8D%9A%E5%AE%A2/" target="_blank" rel="noopener">https://samxrtq.github.io/2019/05/17/Windows%E4%B8%8Emac%E5%8F%8C%E7%AB%AF%E7%94%A8hexo%E5%86%99%E5%8D%9A%E5%AE%A2/</a></p>
<p>问题：<br>1、如何在本机创建多个key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#第一步 创建别名key</span><br><span class="line">ssh-keygen -t rsa -f ~/.ssh/id_rsa.github -C &quot;entere@126.com&quot; </span><br><span class="line">#第二步创建config文件</span><br><span class="line">touch ~/.ssh/config</span><br><span class="line">chmod 600 ~/.ssh/config#根据需要进行这一步（win上没用这一步）</span><br><span class="line">#第三步 编辑config文件，将私钥地址附上去</span><br><span class="line">Host github.com</span><br><span class="line">    IdentityFile ~/.ssh/id_rsa.github</span><br></pre></td></tr></table></figure>

<p>2、hexo d -g的时候提示git不是内部命令<br>解决：检查环境变量，后来发现环境变量的目录git执行文件名字是git_cmd.exe,于是将其改名为git.exe.</p>
<p><img src="%5Cimages%5Cpasted-29.png" alt="upload successful"><br>3、上个问题解决后随即提示add不是内部或外部命令<br>解决：换成bash命令，脱离cmd</p>
<p><img src="%5Cimages%5Cpasted-30.png" alt="upload successful"><br>4、错误：git地址提交混乱，其中gitpagesource应该放源码，不该提到原来的git库里，后来重新按照步骤来了一遍好了。<br>5、不该更改_config.yml里原来的配置。<br>6、图片上传后不展示？<br>找大牛解决，替换了marked.js文件<br>7、mac和win不同步？<br>大牛给贴心画出原理图后秒懂，原因是源码没有在git仓库上同步<br><img src="%5Cimages%5Cpasted-33.png" alt="upload successful"></p>
<p>1.git pull    #将源码从gitpagesource仓库更新<br>2.hexo s后，用admin写博客<br>3.hexo d -g   #将博客推送到chenliyuan.github.io  （hexo d会清空chenliyuan.github.io这个仓库，然后将发布后的html们放上去，chenliyuan.github.io这个仓库就是网址要显示的内容）<br>4.git add.  commit  push  #这一步是为了把源代码上传到GitpageSource仓库，以防你下一个设备用的时候，源代码不同步<br>5.以.md文件存储的，程序会将这些.md文件，给转换为html;你的主题设置，hexo设置，你的网站颜色设置，等等++++你写的博客源码(.md文件)+++图片.然后你hexo g的时候，hexo就会将这些源码进行编译，发布到public文件夹下，那里就是发布后的    其实是一个网站</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">躲不掉的风</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">116</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">躲不掉的风</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
